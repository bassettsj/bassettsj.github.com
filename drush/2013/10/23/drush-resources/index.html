<!doctype html><html lang="en"><head><meta charset="utf-8"><title>Drush Resources・Steven Bassett</title><meta name="author" content="Steven Bassett"><meta name="theme-color" content="#f8f8f8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="X-UA-Compatible" content="IE=edge"><link rel="manifest" href="/manifest.json"><link rel="shortcut icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png"><!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <script src="/assets/js/respond.min.js"></script>
  <![endif]--><link rel="preload" href="https://unpkg.com/st-img@0.1.1/dist/stimg.js" as="script"><link rel="preload" href="/assets/js/main.pkg.js" as="script"><link ref="preload" href="https://www.google-analytics.com/analytics.js" as="script"><link rel="dns-prefetch" href="https://fonts.googleapis.com/"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="dns-prefetch" href="https://unpkg.com"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link href="/assets/css/i.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Lato:400|Vollkorn:400" rel="stylesheet"></head><body><a name="top"></a> <a href="#main-content" class="sr-only-focusable">Skip to main content</a><div class="container"><header class="site-header" role="banner"><nav><a href="/" class="site-title"><b>S</b><span>teven Bassett</span></a><nav role="navigation"><ul class="nav"><li><a href="/archive/" class="active">Archive</a></li><li><a href="/info/">Info</a></li><li><a href="/projects/">Projects</a></li><li><a href="/search/">Search</a></li></ul></nav></nav></header><main class="content" role="main" id="main-content"><article class="post"><header class="page-title"><h1>Drush Resources</h1><p class="intro">Site Deployment and Development - Drush, MAMP and Git</p></header><div class="post-content"><p>Setting up a local Drupal development environment on your Mac and how to use Drush to manage and sync sites.</p><h2>Articles</h2><ul><li><a href="https://drupal.org/node/670460">Using drush to synchronize and deploy sites</a></li><li><a href="http://brianfisher.name/content/drupal-development-environment-os-x-mamp-pro-eclipse-xdebug-and-drush">A Drupal Development Environment on OS X with MAMP Pro, Eclipse, xDebug, and Drush</a></li><li><a href="https://drupal.org/node/601604">getting drush to work on a MAMP setup</a></li><li><a href="http://drush.ws/">Drush Official Site</a></li></ul><h2>Setting up the local environment on a Mac.</h2><ul><li>Download and install <a href="http://www.mamp.info/en/index.html">MAMP</a><ul><li>I like to configure my development enviroment to point to the <code>~/Sites/</code> directory to serve the sites.</li></ul></li><li>Installing git version control<ul><li>Download and install the latest version of <a href="http://git-scm.com/">git</a>.</li><li>Follow the instructions.</li><li>If you’re looking for some enticing reading, check out <a href="http://git-scm.com/book">Pro Git</a> for detailed infomation about git version control.</li></ul></li><li>Installing Drush<ul><li>Please read the following Administration Guide from Drupal.org for the most up to date information on installing drush:<ul><li><a href="https://drupal.org/node/1791676">Specific instructions for installing Drush on different platforms</a></li></ul></li><li>I found the following lines the easiest to set up drush to work with MAMP, not MAMP Pro, The current version of MAMP may require some troubleshooting to get Drush to work correctly. Known issues include:<ul><li>Default use of php5.3.6 instead of php5.2.17 causes errors upon update, most commonly &quot;Cannot redeclare class&quot; errors. To solve, change the version of PHP in the MAMP preferences panel or add a line in your .bash_profile to tell Drush to use the right version of PHP <code>export DRUSH_PHP=&quot;/Applications/MAMP/bin/php/php5.2.17/bin/php&quot;</code>.</li><li>Inability to connect to localhost MySQL via socket. Causes errors like &quot;Error: PDO::__construct(): [2002] No such file or directory (trying<br>to connect via unix:///var/mysql/mysql.sock)&quot;. To solve, from within Terminal run the following commands:<ul><li><code>sudo mkdir /var/mysql</code></li><li><code>sudo ln -s /Applications/MAMP/tmp/mysql/mysql.sock /var/mysql/mysql.sock</code></li></ul></li><li>Please read the following instructions if you have MAMP Pro: &gt; ##MAMP Pro &gt; <a href="http://brianfisher.name/content/drupal-development-environment-os-x-mamp-pro-eclipse-xdebug-and-drush">Original Article</a>* &gt; &gt; These instructions are somewhat specific to MAMP PRO 2.1.1 &gt; &gt; <a href="http://www.mamp.info/en/downloads/index.html">Download</a>, install, and launch &gt; MAMP Pro. Under the PHP tab, select php 5.3.x from version pulldown. Click &gt; &quot;Apply&quot;. Click &quot;Start&quot;. &gt; &gt; Add the MAMP executables to your path. &gt; &gt; &gt; chmod +x /Applications/MAMP/bin/php/php5.3.14/bin/* &gt; echo &quot;export PATH=/Applications/MAMP/bin/php/php5.3.14/bin:/Applications/MAMP/Library/bin:\$PATH&quot; &gt;&gt; ~/.profile &gt; . ~/.profile &gt; &gt; Add a symlink to the MAMP Mysql socket to allow drush to connect. &gt; &gt; &gt; sudo mkdir /var/mysql &gt; sudo ln -s /Applications/MAMP/tmp/mysql/mysql.sock /var/mysql/mysql.sock &gt; ## Performace &gt; &gt; ### MYSQL &gt; &gt; You may get &quot;MySql server has gone away&quot; errors. To fix, in MAMP, edit the &gt; mysql configuration by going to file-&gt;edit template-&gt;mysql. Change &gt; <em>max</em>allowed<em>packet</em> to &gt; &gt; &gt; max<em>allowed</em>packet = 16M &gt; &gt; ### PHP &gt; &gt; Increase both the MAMP PHP memory limit. In MAMP, edit the php configuration &gt; &gt; file-&gt;edit template-&gt;php-&gt;php5.3 &gt; &gt; change <em>memory</em>limit_ to &gt; &gt; &gt; memory<em>limit = 256M &gt; &gt; Increase the CLI PHP memory limit. To figure out where your CLI php.ini file &gt; is, use &gt; &gt; &gt; which php &gt; &gt; php -i | grep php.ini &gt; &gt; change _memory</em>limit_ to &gt; &gt; &gt; memory_limit = -1 ## Cloning production site to your local environment. ##</li></ul></li></ul></li><li>Clone the Git repository.<ul><li>Open Terminal</li><li>Use git to clone the repository for the project you’re working on from our <a href="https://bitbucket.org/nu_lts">Bitbucket Account</a><ul><li>eg <code>git clone git@bitbucket.org:nu_lts/dmc.git ~/sites/dmc.neu.edu/</code> <em>clone from remote to this directory</em></li></ul></li><li>Note that this will only bring down the code that is being tracked by the git repository. It will not bring down any files or directories not tracked by Git.</li></ul></li><li>Setting Up Site Aliases<ul><li>Go to your root apache htdocs folder, in my case <code>cd ~/Sites</code>.</li><li>Set up a file structure such as:<ul><li><code>~/Sites/library.neu.edu/</code> to act as the local root for your Drupal directory.<ul><li>this would be accessible from <a href="localhost:8888/library.neu.edu/">localhost:8888/library.neu.edu/</a></li></ul></li></ul></li><li>Setting up the Drush Aliases for your projects<ul><li>Location: I have used the following location by using: <code>cp /path/to/drush/examples/example.aliases.drushrc.php ~/.drush/aliases.drushrc.php</code> to move the example file with documentation to my home directory that drush will look at to find aliases.<ul><li>In any path set in $options[&#39;alias-path&#39;] in drushrc.php, or (equivalently) any path passed in via --alias-path=... on the command line.</li><li>In one of the default locations:<ul><li>/etc/drush</li><li>$HOME/.drush</li><li>The sites/all/drush folder for the current Drupal site</li></ul></li><li>Inside the sites folder of any bootstrapped Drupal site, or any local Drupal site indicated by an alias used as a parameter to a command.</li></ul></li></ul></li></ul></li></ul><p>Edit the <code>aliases.drushrc.php</code> file by configuring the production, staging and local environment you would like to work with eg:</p><figure class="highlight"><pre><code class="language-text" data-lang="text">$aliases[&#39;dmc.local&#39;] = array(
&#39;uri&#39; =&gt; &#39;localhost:8888/dmc.neu.edu&#39;,
&#39;root&#39; =&gt; &#39;/Users/steven/Sites/dmc.neu.edu&#39;, // This doesn&#39;t work with ~/Sites/dev.local
&#39;db_url&#39; =&gt; &#39;mysql://root:root@localhost:8889/dmc&#39;,
&#39;path-aliases&#39; =&gt; array(
  &#39;%files&#39; =&gt; &#39;sites/defualt/files&#39;,
  &#39;%dump&#39; =&gt; &#39;/Users/steven/tmp/drush/sql-sync-dev-local.sql&#39;, // Arbitrary location for temp files
  ),
);
$aliases[&#39;dmc.prod&#39;] = array(
&#39;uri&#39; =&gt; &#39;defualt&#39;,
&#39;root&#39; =&gt; &#39;/var/www/html&#39;,
&#39;databases&#39; =&gt;
  array (
   &#39;default&#39; =&gt;
   array (
   &#39;default&#39; =&gt;
   array (
   &#39;database&#39; =&gt; &#39;dmc&#39;,
   &#39;username&#39; =&gt; &#39;dmc1&#39;,
   &#39;password&#39; =&gt; ‘****’,
   &#39;host&#39; =&gt; &#39;localhost&#39;,
   &#39;port&#39; =&gt; &#39;&#39;,
   &#39;driver&#39; =&gt; &#39;mysql&#39;,
   &#39;prefix&#39; =&gt; &#39;&#39;,
   ),
   ),
  ),
&#39;remote-user&#39; =&gt; &#39;sbassett&#39;,
&#39;remote-host&#39; =&gt; &#39;155.33.22.226&#39;,
&#39;path-aliases&#39; =&gt; array(
  &#39;%drush&#39; =&gt; &#39;/usr/local/share/drush&#39;,
  &#39;%site&#39; =&gt; &#39;sites/default&#39;,
  &#39;%files&#39; =&gt; &#39;sites/defualt/files&#39;,
  &#39;%dump&#39; =&gt; &#39;tmp&#39;, // Arbitrary location for temp files
  ),
);
</code></pre></figure><h2>Finding the site information for the aliases: Tip from <a href="https://drupal.org/node/670460">Using drush to synchronize and deploy sites</a></h2><p>Creating the site-alias config array is tedious by hand. If you have a working site. Change into the site dir of a working site and run <code>drush site-alias --with-db --show-passwords --with-optional @self</code> I often go <code>drush site-alias --with-db --show-password --with-optional @self &gt; /etc/drush/mysqit.alias.drushrc.php</code> and then <strong>importantly</strong> edit the resulting new files and A: add a <code>&lt;?php</code> tag to the top! B: relabel it from @self to your preferred nickname - which must match the filename you used. Those extra connection details are required for remote aliases. If you want, you can also split out the component parts of an alias and use inheritance to construct the peer alias. For example: &lt;?php $aliases[&#39;mystagingserver&#39;] = array ( &#39;remote-host&#39; =&gt; &#39;mystagingserver.myisp.com&#39;, &#39;remote-user&#39; =&gt; &#39;publisher&#39;, ); $aliases[&#39;peer&#39;] = array ( &#39;parent&#39; =&gt; &#39;@mystagingserver&#39;, &#39;uri&#39; =&gt; &#39;demosite.staging.remote&#39;, &#39;root&#39; =&gt; &#39;/var/www/vhosts/staging/httpdocs’, ); ?&gt;</p><h3>SSH Key Pairs</h3><p><strong>Required for Drush to work with remote servers</strong></p><h4>Check for ssh keys on your computer</h4><p>Go to your .ssh directory: <code>$ cd ~/.ssh</code> Check for keys: $ ls id<em>rsa id</em>rsa.pub If there are no keys like that above try creating the keys using the directions from github:</p><figure class="highlight"><pre><code class="language-text" data-lang="text">$ ssh-keygen -t rsa -C &quot;your_email@youremail.com&quot;
# Creates a new ssh key using the provided email
# Generating public/private rsa key pair.
# Enter file in which to save the key (/Users/you/.ssh/id_rsa): [Press enter]
</code></pre></figure><p>Do not enter a passphrase: Enter passphrase (empty for no passphrase): [Press enter] Enter same passphrase again: [Press enter]</p><p>Should return: Your identification has been saved in /Users/you/.ssh/id<em>rsa. Your public key has been saved in /Users/you/.ssh/id</em>rsa.pub. The key fingerprint is: 01:0f:f4:3b:ca:85:d6:17:a1:7d:f0:68:9d:f0:a2:db your<em>email@youremail.com Make sure to create the <code>touch ~/.ssh/authorized_keys</code> file. Try to create the permissions to be like the following for your environment: $ cd ~/.ssh $ ls -al drwx------ 2 user user 4096 Oct 10 12:31 . drwx------ 3 user user 4096 Oct 10 12:51 .. -rw------- 1 user user 808 Oct 10 12:50 authorized</em>keys -rw------- 1 user user 1675 Oct 10 12:31 identity -rw------- 1 user user 1675 Oct 10 12:16 id<em>rsa -rw-r--r-- 1 user user 398 Oct 10 12:16 id</em>rsa.pub SSH into the remote server: $ ssh user@example.neu.edu Create a keypair for the remote server using the same method above. <strong>(Don’t forget to check the permissions)</strong> When you have completed the steps on both your local and remote machines, then you can add your key to the remote server. From your <strong>local terminal</strong>: $ login=username@hostname $ ssh $login &quot;echo &#39;<code>cat ~/.ssh/id_rsa.pub</code>&#39; &gt;&gt; ~/.ssh/authorized_keys&quot;</p><p>To debug what might be happening you can run: $ ssh -v user@server.edu <strong><em>Need more assistance making a bootstrap way of creating key pairs.</em></strong></p><h2>Using Drush commands on remote servers</h2><p>To use drush commands on a remote server you can simply use the alias for. For example I can look and see the basic site status for the DMC website. $ drush @dmc.prod status Site URI : defualt<br>Database driver : mysql<br>Database hostname : localhost<br>Database username : dmc1<br>Database name : dmc<br>Database : Connected<br>Drupal bootstrap : Successful<br>Drupal user : Anonymous<br>Default theme : dmc<br>Administration theme : seven<br>PHP configuration : /etc/php.ini<br>Drush version : 5.6<br>Drush configuration :<br>Drupal root : /var/www/html<br>Site path : sites/default<br>File directory path : sites/default/files<br>Private file directory path : sites/default/files/private temp : tmp<br>Drupal version : 7.15</p><h2>Using rsync to fetch files from the remote server.</h2><p>Go fetch the files from our production server to local server: drush rsync @dmc.prod:%files/ @dmc.local:%files/</p><h2>Using drush to run a site install</h2><p>Before running the command please make sure to look at <code>drush site-install —help</code> for instructions. To install the local site into mamp you can run the following command:</p><figure class="highlight"><pre><code class="language-text" data-lang="text">$ drush @dmc.local use
$ drush si
</code></pre></figure><p>If the aliases are configured correctly, you can go the the local url eg localhost:8888/dmc.neu.edu/ and it should install a basic site. Nothing special.</p><h2>Using drush to sync the databases</h2><p><em>Note: you will probably want to clear the cache on both sites before the transfer</em> <code>$ drush cc all</code>. Use the drush <code>sql-sync</code> command to send from source to target. For example to create your local enviromnet, you will want to pull down the sql database using: <code>$ drush sql-sync @dmc.prod @dmc.local</code></p><h2>Notes for trouble shooting White-Screen-Of-Death (WSOD)</h2><ul><li><p>Try turning off clean urls:</p><figure class="highlight"><pre><code class="language-text" data-lang="text">$ drush vset --exact clean_url 0
clean_url was set to 1.                                                                  [success]      
</code></pre></figure></li><li><p>Clear the cache <code>$ drush cc all</code></p></li><li><p>Look at the settings.php file in the sites/default/ directory</p></li><li><p>Look at the .htaccess file</p></li><li><p>Refer to the php.ini files to make sure that MAMP is configured to give enough memory for both drush and drupal to run.</p></li><li><p>Check your mysql and php error logs, with MAMP they are located:</p><ul><li>/Applications/MAMP/logs/</li></ul></li></ul></div><footer><div><ul class="pagination"><li class="prev"><a href="/presentations/2013/10/13/scholar-onesearch-presentation/" title="Scholar OneSearch Presentation">&larr;</a></li><li><a href="/archive/">Archive</a></li><li class="next"><a href="/2013/10/25/bad-camp-2013/" title="BAD Camp 2013">&rarr;</a></li></ul></div><div id="disqus_thread"></div><script async defeer>var disqus_developer = 1;
    var disqus_shortname = 'aboutsjbassett'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a></footer><aside><h4>Published</h4><div class="date"><span>23 October 2013</span></div><h4>Tags</h4><ul class="tag-box"><li><a href="/search/#drupal-ref">drupal <span class="label">2</span></a></li><li><a href="/search/#drush-ref">drush <span class="label">1</span></a></li><li><a href="/search/#git-ref">git <span class="label">1</span></a></li><li><a href="/search/#mamp-ref">mamp <span class="label">1</span></a></li><li><a href="/search/#developer tools-ref">developer tools <span class="label">1</span></a></li></ul></aside></article></main></div><footer class="site-footer container" role="contentinfo"><div class="container clear-fix"><a href="#top" class="pull-right">Back to Top</a></div><p>&copy; Steven Bassett 2018</p><p>I &hearts; the open web.</p><ul class="social nav"><li><a href="http://www.twitter.com/bassettsj" title="Steven Bassett on Twitter">Twitter</a></li><li><a href="http://www.github.com/bassettsj" tittle="Steven Bassett on Github">Github</a></li><li><a href="http://www.linkedin.com/pub/steven-bassett/27/829/468" title="Steven Bassett on LinkedIn">LinkedIn</a></li></ul></footer><script async defer="defer" src="https://unpkg.com/st-img@0.1.1/dist/stimg.js"></script><script async defer="defer" src="/assets/js/main.pkg.js"></script><script async defer="defer">(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='https://www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create', 'UA-29704023-1', 'auto');ga('send', 'pageview');</script></body></html>